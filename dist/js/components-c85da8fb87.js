"use strict";function Adapter(e,t){var r=t;if(!t){r=[];for(var a in e[0])r.push(a)}for(var o=[],i=0;i<e.length;i++){for(var n=[],s=0;s<r.length;s++)n.push(e[i][r[s]]);o.push(n)}return o}function POST(e,t){var t=JSON.stringify(t);return $.ajax({url:e,contentType:"application/json; charset=utf-8",type:"POST",data:t,dataType:"json",async:!1}).responseJSON}function DELETE(e){return $.ajax({url:e,contentType:"application/json; charset=utf-8",type:"DELETE",dataType:"json",async:!1}).responseJSON}function PUT(e,t){var t=t?JSON.stringify(t):"";return $.ajax({url:e,contentType:"application/json; charset=utf-8",type:"PUT",data:t,dataType:"json",async:!1}).responseJSON}function GET(e){return $.ajax({url:e,contentType:"application/json; charset=utf-8",type:"GET",dataType:"json",async:!1}).responseJSON}function ClearInputs(e,t){for(var r=(e=$(e)).find("input"),a=0;a<r.length;a++)t?$.inArray($(r[a]).attr("id"),t)>-1&&$(r[a]).val(""):$(r[a]).val("")}function ClearInputsBut(e,t){t=t||[];for(var r=(e=$(e)).find("input"),a=0;a<r.length;a++)-1==$.inArray($(r[a]).attr("id"),t)&&$(r[a]).val("")}function ClearTextArea(e){for(var t=(e=$(e)).find("textarea"),r=0;r<t.length;r++)$(t[r]).val("")}function ClearSelection(e){for(var t=(e=$(e)).find("select"),r=0;r<t.length;r++)$(t[r]).val("-1")}function ClearRadio(e){for(var t=(e=$(e)).find("input:radio"),r=0;r<t.length;r++)t[r].checked=!1}function ClearAllFields(e){ClearAllFieldsBut(e)}function ClearAllFieldsBut(e,t){ClearInputsBut(e,t),ClearTextArea(e),ClearSelection(e),ClearRadio(e)}function isAllPRTypeFormFieldEmpty(e){for(var t=$(e).find("input"),r=$(e).find("textarea"),a=$(e).find("select"),o=!0,i=0;i<t.length;i++)o=o&&0==$(t[i]).val().length;for(i=0;i<r.length;i++)o=o&&0==$(r[i]).val().length;for(i=0;i<a.length;i++)o=o&&"-1"==$(t[i]).val();return o}function formToSet(e){for(var t=(e=$(e).is("form")?$(e):$(e).find("form")).serializeArray(),r={},a=0;a<t.length;a++){var o=t[a],i=o.name,n=o.value;r[i]=n}return r}function arrayToSet(e,t){for(var r={},a=0;a<e.length;a++){var o=e[a];r[o[t]]=o}return r}function setToArray(e,t){var r=[];if(t)for(a=0;a<t.length;a++)r.push(e[t[a]]);else for(var a in e)r.push(e[a]);return r}function autoComplateInfo(e,t,r){t=$(t);for(var a in e){var o=e[a];""!=r&&void 0!=r&&(a=r+a);var i=t.find("*[name="+a+"]");i.is("input")||i.is("select")||i.is("option")||i.is("textarea")?i.val(o):i.text(o)}}function generateUUID(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}function getValueArrayFromObjectArray(e,t){for(var r=[],a=0;a<e.length;a++)r.push(e[a][t]);return r}function getValueSetFromObjectArray(e,t,r){for(var a={},o=0;o<e.length;o++)a[e[o][t]]=e[o][r];return a}function isStringEmpty(e){return""===e||void 0==e||null==e}function deleteFromObjectArray(e,t,r){for(var a=-1,o=0;o<e.length;o++)if(e[o][t]==r){a=o;break}return a>=0&&e.splice(a,1),e}function formToSet(e){for(var t=(e=$(e)).serializeArray(),r={},a=0;a<t.length;a++){var o=t[a],i=o.name,n=o.value;r[i]=n}return r}function login(){var e=formToSet("#login_form"),t=e.username,r=e.password;switch(window.role){case"admin":case"Admin":(a=apiConfig.systemuser.Login(t,r))?(window.location.href="./admin-home.html",setCookie("auth","Admin"),setCookie("role",Enum.role.SYSADMIN),setCookie("name",a._accountname),setCookie("account",a._accountname),setCookie("uid",a._id),setCookie("user",JSON.stringify(a))):new MessageAlert("登陆失败，请检查用户名密码是否正确！",MessageAlert.Status.EXCEPTION);break;case"dealer":case"Dealer":(a=apiConfig.dealer.Login(t,r))?(window.location.href="./dealer-home.html",setCookie("auth","Dealer"),setCookie("role",Enum.role.DEALEAR),setCookie("name",a._accountname),setCookie("account",a._accountname),setCookie("uid",a._id),setCookie("user",JSON.stringify(a))):new MessageAlert("登陆失败，请检查用户名密码是否正确！",MessageAlert.Status.EXCEPTION);break;case"supplier":case"Supplier":(a=apiConfig.supplier.Login(t,r))?(window.location.href="./supplier-home.html",setCookie("auth","Supplier"),setCookie("role",Enum.role.SUPPLIER),setCookie("name",a._accountname),setCookie("account",a._accountname),setCookie("uid",a._id),setCookie("user",JSON.stringify(a))):new MessageAlert("登陆失败，请检查用户名密码是否正确！",MessageAlert.Status.EXCEPTION);break;case"zeiss":case"Zeiss":var a=apiConfig.employee.Login(t,r);console.log(a),a.statusField?new MessageAlert("登陆失败，请检查用户名密码是否正确！",MessageAlert.Status.EXCEPTION):(window.location.href="./zeiss-home.html",setCookie("auth","Zeiss"),setCookie("role",Enum.role.EMPLOYEE),setCookie("name",a.nameField),setCookie("account",a.accountField),setCookie("user",JSON.stringify(a)))}return!1}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tab_init=function(){$("#myTab a:first").tab("show"),$("#myTab a").click(function(e){e.preventDefault(),$(this).tab("show");$(this).attr("href")})},Loading={show:function(){if(window.LoadingMarker)window.LoadingMarker.show();else{var e=$("<div class='Loading'>"),t=$('<div class="wrapper"><div class="loadingspan"><div class="help"></div></div></div>');e.append(t),window.LoadingMarker=e,$("body").append(window.LoadingMarker)}},hide:function(){window.LoadingMarker&&window.LoadingMarker.hide()}},MessageAlert=function e(t,r){this.status=r||e.Status.SUCCESS,this.msg=t||"Congratulation! Action performed!",this.statusCode=0,this.html=null,this.dropback=null,this.showoutTime=600,this.showtime=1e3,this.hideTime=300,this.show(this.mse,this.status)};MessageAlert.prototype.new=function(e,t){return this.msg=e||this.msg,this.status=t||this.status,this.html&&this.html.remove(),this.html=this.generateHTML(this.msg,this.status),this.html.css("display","none"),$("body").append(this.html),this.dropback||(this.dropback=$('<div class="MassageAlert_dropback"></div>'),$("body").append(this.dropback)),this.html},MessageAlert.prototype.generateHTML=function(e,t){var r='\n      <div class="MassageAlert_Warp">\n        <div class="MassageAlert">\n          <label class="MassageAlert_Title">\n            <i class="Icon"></i>\n            <span class="Status">'+t+'</span>\n          </label>\n          <div class="MassageAlert_Body">\n            <span>'+e+'</span>\n          </div>\n          <div class="MassageAlert_Footer"></div>\n        </div>\n      </div>\n      ';return $(r)},MessageAlert.prototype.destory=function(){this.html&&this.html.remove(),this.dropback&&this.dropback.remove()},MessageAlert.prototype.show=function(e,t){if(!this.inStatus(t))throw"Error Status";this.new(e,t).show(this.showoutTime),this.dropback.fadeIn(this.showoutTime);var r=this;return setTimeout(function(){r.hide(),setTimeout(function(){r.destory()},r.hideTime)},r.showoutTime+r.showtime),this},MessageAlert.prototype.hide=function(){return this.html.hide(this.hideTime),this.dropback.fadeOut(this.hideTime),this},MessageAlert.Status={SUCCESS:"SUCCESS",EXCEPTION:"EXCEPTION",ERROR:"ERROR"},MessageAlert.prototype.inStatus=function(e){var t=!1;if("string"!=typeof e)throw"invalid status";for(var r in MessageAlert.Status)t=e.toUpperCase()===MessageAlert.Status[r]||t;return t};var counter=0;$(document).unbind("hidden.bs.modal").on("hidden.bs.modal",".modal",function(e){$(this).css("z-index",1050),counter--}),$(document).unbind("show.bs.modal").on("show.bs.modal",".modal",function(e){$(this).css("z-index",1050+counter),counter++});var contentmapper={MyOrder:"MyOrder.html",OrderAdmin:"OrderAdmin.html",BrochureAdmin:"BrochureAdmin.html",DealerAdmin:"DealerAdmin.html",SupplierAdmin:"SupplierAdmin.html",SystemAdmin:"SystemAdmin.html",Inventory:"Inventory.html",Dictionary:"Dictionary.html",Approval:"Approval.html",Workflow:"Workflow.html"},hyperlink_init=function(){$(".nav .section a").on("click",function(){var e=$(this).attr("href").substring(1),t=contentmapper[e];""!=t&&void 0!=t&&$.ajax({url:"./content/"+getCookie("auth")+"/"+t,async:!1,success:function(e){$("#content_wapper").empty(),$("#content_wapper").append(e.trim()),initPageByName("content"),sideclose()}})})},sideopen=function(){$(".sideBtn").removeClass("nav_collapse").addClass("nav_open"),$(".topNav").removeClass("nav_collapse").addClass("nav_open"),$(".sideBtn .glyphicon").removeClass().addClass("glyphicon").addClass("sideBtnIcon-open")},sideclose=function(){$(".sideBtn").removeClass("nav_open").addClass("nav_collapse"),$(".topNav").removeClass("nav_open").addClass("nav_collapse"),$(".sideBtn .glyphicon").removeClass().addClass("glyphicon").addClass("sideBtnIcon-close")},pageHelperConfig={rowsPerPage:10},generateTableWithPageHelper=function(e){var t=e.target,r=e.templateOpts,a=e.counter,o=e.datasourceAPI,i=0+pageHelperConfig.rowsPerPage,n=e.options||{role:getCookie("role"),uid:getCookie("uid")};n.status=n.status,n.startIndex=0,n.endIndex=i;var s=function(e,t){return function(t){return e.call(this,t)}}(o);(new table).loadFromTemplateJson(s(n),r).to(t),new pageHelper({recordsCount:a,target:t,callback:function(e){n.startIndex=e.startIndex,n.endIndex=e.endIndex,(new table).loadFromTemplateJson(s(n),r).to(this.target)}})},pageHelper=function(e){this.rowsPerPage=e.rowsPerPage|pageHelperConfig.rowsPerPage,this.currentPage=1,this.recordsCount=0|e.recordsCount,this.pagesCount=Math.ceil(this.recordsCount/this.rowsPerPage),this.startIndex=0,this.endIndex=this.startIndex+this.rowsPerPage,this.callback=e.callback,this.target=$(e.target),this.target.append(this.generate())};pageHelper.prototype.generate=function(){if(!(this.recordsCount/this.rowsPerPage<1)){var e=$('<ul class="pagination">'),t=$('<nav style="text-align: center">');t.append(e);for(var r=1;r<=this.pagesCount;r++){var a=$('<a href="#">'+r+"</a>"),o=$("<li></li>"),i=this;r==this.currentPage&&(e.find("li").removeClass("active"),o.addClass("active")),o.on("click",{page:r,that:i},function(t){e.find("li").removeClass("active"),$(this).addClass("active"),t.data.that.to(t.data.page),console.log(t.data)});var n=o.append(a);e.append(n)}return t}},pageHelper.prototype.next=function(){var e=this.currentPage+1;this.to(e)},pageHelper.prototype.last=function(){var e=this.currentPage-1;this.to(e)},pageHelper.prototype.to=function(e){if(e>this.pagesCount||e<=0)console.log("ERROR PAGES");else{if(this.currentPage=e,this.startIndex=(this.currentPage-1)*this.rowsPerPage,this.endIndex=this.startIndex+this.rowsPerPage-1,this.currentPage==this.pagesCount){var t=this.recordsCount%this.rowsPerPage;0!=t&&(this.endIndex=this.startIndex+t)}this.callback.apply(this,[{startIndex:this.startIndex,endIndex:this.endIndex}]),this.target.append(this.generate())}};var queryKeyWords=function(e,t){var r=[],a=[];for(var o in t){var i=new RegExp(e,"i");if(t[o].search(i)>=0){var n=t[o].match(i);a.push(t[o]);var s=t[o].replace(n,"<b>"+n+"</b>");r.push(s)}}return{blod:r,raw:a}},bindOptionData=function(e){var t=e.$select,r=e.datasource,a=e.innerTextName,o=e.valueName;(t=$(t)).empty();t.data("source");var i=null,n=null;i=a,n=o,t.append('<option value="-1" selected="selected">请选择</option>');for(var s=0;s<r.length;s++){var u=r[s],l='<option value="'+u[n]+'">'+u[i]+"</option>";t.append($(l))}},bindInputQuery=function(e){var t=e.input,r=e.datasourceAPI,a=e.searchObj,o=e.innerTextName,i=e.valueName,n=e.delay,s=e.callback,u=$(t);u.unbind("keyup");var l=u.siblings("select.queryinput");u.after("<ul class='dropdown-menu keyhint'>");n=n||600;u.on("keyup",function(e){e.preventDefault(),window.timer&&clearTimeout(window.timer),l.empty(),l.append('<option value="-1" selected="selected"></option>');var t=this;window.timer=setTimeout(function(){var e=t.value;a.keyword=e;var n=r(a),d=getValueArrayFromObjectArray(n,o),p=getValueSetFromObjectArray(n,o,i),c=arrayToSet(n,i),h=u.siblings(".keyhint");h.empty();for(var m=queryKeyWords(e,d),f=0;f<m.raw.length;f++){var g=p[m.raw[f]],y=$("<li></li>"),v=$("<a href=\"#\" class='keywords' value='"+g+"'></a>");v.html(m.blod[f]),y.append(v),h.append(y)}m.raw.length>0&&""!=e?(u.parent(".search_box_warp").addClass("open"),$(".keywords").on("click",function(e){bindOptionData({$select:l,datasource:n,innerTextName:o,valueName:i});var t=$(this).attr("value");l.val(t),u.val(this.innerText),h.empty(),u.parent(".search_box_warp").removeClass("open");var r=c[t];s&&s(r)})):u.parent(".search_box_warp").removeClass("open")},n)})},table=function(e){this.tableName="",this.url=e,this.urlTimestamp=null,this.tableHTML=null,this.keyArr=[],this.responseJson=null,this.hasButton=!1,this.buttonPool=[],this.hasHeader=!1,this.hasDetail=!1,this.Header=null,this.container=null,this.PrimaryKeyIndex=null,this.data={},this.isUpdated=!1};table.prototype.load=function(e){return void 0!==e&&""!==e&&(this.url=e),(null==this.urlTimestamp||this.timeDiff()>60||this.isUpdated)&&(this.fetch(this.url).init().bindEvents(),this.urlTimestamp=new Date),this},table.prototype.loadFromTemplateJson=function(e,t){if("string"==typeof e){void 0!==e&&""!==e&&(this.url=e);var r=e.split(".");if(r.length-1==r.lastIndexOf("json"))return this.load(e)}var a={tablename:"template",hasHeader:!1,hasDetail:!1,hasButton:!1,viewOrder:[],keyArr:[],data:[[""]]};if(a.tablename=t.tablename?t.tablename:"table",a.hasHeader=!!t.hasHeader&&t.hasHeader,a.hasDetail=!!t.hasDetail&&t.hasDetail,a.hasButton=!!t.hasButton&&t.hasButton,a.buttonPool=t.buttonPool?t.buttonPool:[],a.keyArr=t.keyArr?t.keyArr.slice(0):[],a.data=t.data?t.data.slice(0):[],a.viewOrder=t.viewOrder?t.viewOrder:void 0,null==this.urlTimestamp||this.timeDiff()>60||this.isUpdated){var o=Adapter("object"==(void 0===e?"undefined":_typeof(e))?e:GET(e),a.viewOrder);a.data=a.data.concat(o),this.responseJson=a,this.init().bindEvents(),this.urlTimestamp=new Date}return this},table.prototype.timeDiff=function(){return((new Date).getTime()-this.urlTimestamp.getTime())/1e3},table.prototype.fetch=function(e){var t=$.ajax({url:e,type:"GET",cache:!1,async:!1});return this.responseJson=JSON.parse(t.responseText),this},table.prototype.init=function(){this.tableName=this.responseJson.tablename,this.hasHeader=this.responseJson.hasHeader,this.hasDetail=this.responseJson.hasDetail,this.buttonPool=this.responseJson.buttonPool,this.hasButton=!!this.responseJson.hasButton&&this.responseJson.buttonPool,this.keyArr=this.responseJson.keyArr.slice(0),this.PrimaryKeyIndex=this.keyArr.indexOf("id");var e=this.responseJson.data.slice(0),t=$('<table class="table table-bordered table-hover table-striped"></table>'),r=$("<tbody></tbody>");if(t.append(r),this.tableHTML=t,this.hasHeader&&!this.Header){var a=e.reverse().pop();this.Header=a.slice(0),this.hasButton&&(this.Header.push("操作"),this.keyArr.push("operation"));var o=new table_row(this.Header,this,!0);r.append(o.HTMLObj),e.reverse()}for(var i=0;i<e.length;i++)this.addRow(e[i]);return this.addInfoCard(),this},table.prototype.to=function(e){return e=$(e),this.container=e,e.empty(),e.append(this.tableHTML),this},table.prototype.bindEvents=function(e){if(this.hasDetail){e=e||Detail;var t=this.data;for(var r in t)t[r].onClick(function(){e.call(this,this.dataset.primarykey)}),t[r].onCardLongPress(500,function(){e.call(this,this.dataset.primarykey)});return this}},table.prototype.addInfoCard=function(){this.tableHTML.find("tr:not(.info_card_row)").children("*").addClass("hidden-xs");var e=["#6b85a4","#86909e","#b3b2cd"],t=0;for(var r in this.data)if("header"!=r){var a=this.data[r];a.CardHTMLObj&&a.CardHTMLObj.remove(),a.rowAddCard(e[t%e.length]),a.buildCard(),$(a.HTMLObj).before(a.CardHTMLObj),t++}return this},table.prototype.new=function(e,t){e.data=e.data?e.data:[];var r=e;return e.hasHeader||r.data.pop(),this.responseJson=r,this.init(),this},table.prototype.addRow=function(e){var t=$(this.tableHTML).find("tbody"),r=new table_row(e,this,!1,this.Header),a=e[this.PrimaryKeyIndex];this.data[a],this.data[a]=r,t.append(r.HTMLObj),this.addInfoCard(),this.isUpdated=!0},table.prototype.editRow=function(e,t){},table.prototype.onCardLongPress=function(e){for(var t in this.data)this.data[t].onCardLongPress(500,e)},table.prototype.onClick=function(e){for(var t in this.data)this.data[t].onClick(e)},table.prototype.remove=function(){for(var e in this.data)this.data[e].remove()},table.prototype.update=function(e,t){var r=arrayToSet(this.responseJson.data,this.PrimaryKeyIndex);if(t instanceof Array)r[e]=t;else{var a=setToArray(t,this.responseJson.viewOrder);r[e]=a}return this};var table_buttonPool={pool:{editBtn:"<button type='button' name='button' class='btn btn-primary edit' onclick='edit(${PrimaryKey})'>编辑</button>",PIEditBtn:"<button type='button' name='button' class='btn btn-primary edit' onclick='PurchaseItem.view.edit(${PrimaryKey})'>编辑</button>",submitBtn:"<button type='button' name='button' class='btn btn-primary submit' onclick='submit(${PrimaryKey})'>提交</button>",deleteBtn:"<button type='button' name='button' class='btn btn-danger del' onclick='Delete(${PrimaryKey})'>删除</button>",PIdeleteBtn:"<button type='button' name='button' class='btn btn-danger del' onclick='PurchaseItem.event.delete(${PrimaryKey})'>删除</button>",updateBtn:"<button type='button' name='button' class='btn btn-primary update' onclick='update(${PrimaryKey})'>更新</button>",supplyBtn:"<button type='button' name='button' class='btn btn-success supply' onclick='supply(${PrimaryKey})'>入库</button>",approveBtn:"<button type='button' name='button' class='btn btn-primary approve' onclick='approve(${PrimaryKey})'>通过</button>",rejectBtn:"<button type='button' name='button' class='btn btn-danger reject' onclick='reject(${PrimaryKey})'>拒绝</button>",expressUpdateBtn:"<button type='button' name='button' class='btn btn-success expressUpdate' onclick='SupplierPRDetail.view.update(${PrimaryKey})'>更新物流</button>",expressViewBtn:"<button type='button' name='button' class='btn btn-success expressView' onclick='expressStatus(${PrimaryKey})'>物流状态</button>",finishedBtn:"<button type='button' name='button' class='btn btn-primary finish' onclick='finish(${PrimaryKey})'>完成订单</button>",historyBtn:"<button type='button' name='button' class='btn btn-success history' onclick='History(${PrimaryKey})'>历史纪录</button>",copyBtn:"<button type='button' name='button' class='btn btn-primary copy' onclick='copy(${PrimaryKey})'>复制</button>",deleteDraftBtn:"<button type='button' name='button' class='btn btn-danger del' onclick='deleteDraft(${PrimaryKey})'>删除</button>"},genetrate:function genetrate(PrimaryKey,btnName){var btnString=table_buttonPool.pool[btnName].replace("${PrimaryKey}",'"'+PrimaryKey+'"');return eval($(btnString))}},table_row=function(e,t,r,a){this.ParentTable=t,this.hasButton=t.hasButton,this.buttonPool=t.buttonPool,this.keyArr=t.keyArr,this.PrimaryKeyIndex=t.PrimaryKeyIndex,this.PrimaryKeyValue=e[this.PrimaryKeyIndex],this.isHeader=r,this.Headers=this.isHeader?e:a,this.data=e,this.JSONObj=e,this.HTMLObj=this.init(),this.CardJSONObj=null,this.CardHTMLObj=null};table_row.prototype.init=function(){for(var e=this.isHeader?$("<tr id='header'></tr>"):$("<tr></tr>"),t=0;t<this.data.length;t++)if(this.isHeader){var r=$("<th></th>");e.append(r.html(this.Headers[t]))}else{a=$("<td data-primaryKey='"+this.PrimaryKeyValue+"'></td>");e.append(a.html(this.data[t]))}if(this.hasButton&&!this.isHeader){var a=$("<td class='operation'></td>"),o=[];for(var t in this.buttonPool){var i=table_buttonPool.genetrate(this.PrimaryKeyValue,this.buttonPool[t]);i.prop("parentTable",this.ParentTable),i.prop("parentRow",this),o.push(i)}for(t=0;t<o.length;t++)a.append(o[t]);e.append(a)}return e},table_row.prototype.rowAddCard=function(e){var t=this.HTMLObj,e=e||"#6b85a4",r={},a={},o=null;for(var i in this.keyArr){var n=t.children("td");a[this.Headers[i]]=$(n[i]).html(),this.keyArr[i].search("hide")>=0||("key"!=this.keyArr[i]&&"id"!=this.keyArr[i]||(r[this.Headers[i]]=$(n[i]).html()),"publishDate"==this.keyArr[i]&&(o=$(n[i]).html()))}var s={Header:r,Bgcolor:e,Props:a,Date:o||""};return this.CardJSONObj=s,s},table_row.prototype.buildCard=function(){var e=this.CardJSONObj.Header,t=this.CardJSONObj.Props,r=(this.CardJSONObj.Date,this.CardJSONObj.Bgcolor),a=this.PrimaryKeyValue,o="";for(var i in e){var n=t[i];n.length>20&&(n=n.substring(0,20)+"..."),o+=i+":"+n,o+=",<br>"}o=o.substring(0,o.lastIndexOf(","));var s=[];for(var u in t){var l=function(e,t){return'\n      <div class="row card_data_row" data-primaryKey="'+a+'">\n        <div class="col-xs-4 card_data_title" data-primaryKey="'+a+'">\n        '+(e=e)+':\n        </div>\n        <div class="col-xs-8 card_data" data-primaryKey="'+a+'">\n        '+(t=t)+"\n        </div>\n      </div>\n      "}(u,t[u]);s.push(l)}var d='<tr class="info_card_row" >\n        <td colspan="1">\n          <div class="card col-xs-12 row" style="border-color:'+r+'">\n            <div class="card_head row" style="background-color:'+r+'">\n              '+o+'\n            </div>\n            <div class="card_body" data-primaryKey="'+a+'">\n              '+s.join("")+'\n            </div>\n            <div class="card_foot row">\n              <div class="date">\n                data:yyyy-mm-dd\n              </div>\n            </div>\n          </div>\n        </td>\n      </tr>';return this.CardHTMLObj=$(d),this.CardHTMLObj.find(".card_head").siblings("div").hide(),this.CardHTMLObj.find(".card_head").on("click",function(){$(this).siblings("div").toggle()}),this.CardHTMLObj},table_row.prototype.remove=function(){this.HTMLObj&&(this.HTMLObj.remove(),this.JSONObj=""),this.CardHTMLObj&&(this.CardHTMLObj.remove(),this.CardJSONObj="")},table_row.prototype.add=function(){},table_row.prototype.onCardLongPress=function(e,t){var r=null;console.log("longPress binded!"),$(this.CardHTMLObj).find(".card_body").on({touchstart:function(a){console.log("touch start!"),r=setTimeout(t.bind(this),e)},touchmove:function(){console.log("touch moving!"),clearTimeout(r),r=0},touchend:function(){return console.log("touch end!"),clearTimeout(r),!1}})},table_row.prototype.onClick=function(e){console.log("click binded"),$(this.HTMLObj).find("td:not('.operation')").on("click",e)};var regxRule={string:{regx:function(e,t){var r=e;return"^.{"+(r+=","+t)+"}$"},msg:"请输入至少min,最多max位字符，不能输入带有#￥%_等特殊符号。"},account:{regx:"",msg:""},email:{regx:"\\w[-\\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\\.)+[A-Za-z]{2,14}",msg:"请输入正常的邮箱"},phone:{regx:"(13\\d|14[57]|15[^4,\\D]|17[13678]|18\\d)\\d{8}|170[0589]\\d{7}|[0-9-()（）]{7,18}",msg:"请输入正确的手机号码或者座机号码！"},number:{regx:function(e,t){var r="",a="";if(void 0!=e){var o=e;r="请输入至少"+e+",最多不超过"+t+"位的数字！",a="^\\d{"+(o+=","+t)+"}$"}else r="请输入数字！",a="^\\d{1,}$";return regxRule.number.msg=r,a},msg:"请输入至少min,最多不超过max位的数字！"},notnull:{regx:"\\S{1,}",msg:"不能为空！"},select:{regx:"[^-1]\\d*",msg:"请选择！"},selectBrochure:{regx:"[^-1]\\d*",msg:"没有找到该物品！请确认后提交！"},selectEmployee:{regx:"[^-1]\\d*",msg:"没有找到该员工！请确认后查询！"},selectDealer:{regx:"[^-1]\\d*",msg:"没有找到该代理商！请确认后查询！"},password:{},checkbox:{regx:function(e,t){}},radio:{}},validator={init:function(){for(var e=$("form[data-validator=true]").find("*[data-regxRule]"),t=0;t<e.length;t++){var r=$(e[t]);if(r.is("input"))switch(r.attr("type")||"text"){case"password":case"text":case"email":case"tel":case"url":case"search":r.unbind("keyup"),r.on("keyup",function(e){var t=$(e.target),r=t.data("regxrule"),a=validator.validate(t,r);validator.displayResult(t,a)});break;case"radio":case"checkbox":case"hidden":r.unbind("change"),r.on("change",function(e){var t=$(e.target),r=t.data("regxrule"),a=validator.validate(t,r);validator.displayResult(t,a)})}else r.is("select")?(r.unbind("change"),r.on("change",function(e){var t=$(e.target),r=t.data("regxrule");console.log(t);var a=validator.validate(t,r);validator.displayResult(t,a)})):r.is("textarea")&&(r.unbind("keyup"),r.on("keyup",function(e){var t=$(e.target),r=t.data("regxrule"),a=validator.validate(t,r);validator.displayResult(t,a)}))}},validate:function validate(target,rule){var result={},regStr="",regxResult=rule.split(/\(([^)]*)\)/),category=regxResult[0],limit=regxResult[1],c=null;if(c=regxRule[category]){if(c=regxRule[category]){if("function"==typeof c.regx)if(limit){var limitList=limit.split(","),min="",max="",MinAndMax="";if(limitList.length>2)console.log("only two integers required,Max and Min");else if(2==limitList.length)try{var i1=parseInt(limitList[0]),i2=parseInt(limitList[1]);max=i1>i2?i1:i2,min=i1<i2?i1:i2}catch(e){console.log(e)}else min=parseInt(limitList[0]);regStr=c.regx(min,max)}else regStr=c.regx();else regStr=c.regx;var regexp=new RegExp(regStr),value=$(target).is("input")||$(target).is("select")?$(target).val():$(target).text();result.result=regexp.test(value),result.msg=c.msg}}else{var str=category;try{c=eval(str)}catch(e){c=str}if("function"==typeof c)result.result=c(target),result.warning=result.result?"OK":"ERROR";else if("string"==typeof c){regStr=c;var regexp=new RegExp(regStr),value=$(target).is("input")?$(target).val():$(target).text();result.result=regexp.test(value),result.warning=result.result?"OK":"ERROR"}}return result},displayResult:function(e,t){t.result?validator.pass(e):validator.error(e,t)},error:function(e,t){e=$(e);t.result;var r=t.msg,a=e.parent("div");e.attr("validate",!1),a.removeClass("has-success").addClass("has-error"),a.find("i.validator_error").remove(),a.append('<i class="validator_error text-danger">'+r+"</i>")},pass:function(e){var t=(e=$(e)).parent("div");e.attr("validate",!0),t.removeClass("has-error").addClass("has-success"),t.find("i.validator_error").remove()},Restore:function(){for(var e=$("form[data-validator=true]").find("*[data-regxRule]"),t=0;t<e.length;t++){var r=$(e[t]),a=r.parent("div");r.attr("validate",!1),a.removeClass("has-error").removeClass("has-success"),a.find("i.validator_error").remove()}},Result:function(e){if((e=$(e)).data("validator"))for(var t=e.find("*[data-regxRule]"),r=!0,a=0;a<t.length;a++){var o=$(t[a]),i=validator.validate(o,o.data("regxrule"));validator.displayResult(o,validator.validate(o,o.data("regxrule"))),r=i.result&&r}return r}},BrochureAdmin={view:{add:{show:function(){BrochureAdmin.event.init(),$("#Add").modal()},hide:function(){BrochureAdmin.event.destory(),$("#Add").modal("hide")}},edit:{show:function(){BrochureAdmin.event.init(),$("#Edit").modal()},hide:function(){BrochureAdmin.event.destory(),$("#Edit").modal("hide")}},delete:{show:function(){$("#Delete").modal()},hide:function(){$("#Delete").modal("hide")}},supply:{show:function(){$("#Supply").modal()},hide:function(){$("#Supply").modal("hide")}},history:{show:function(e){BrochureHistory.show(e)},hide:function(){$("#History").modal("hide")}}},event:{add:function(){var e=formToSet("#add_Brochure");e._createtime=new Date,apiConfig.brochure.Add(getCookie("account"),e)>0?(new MessageAlert("添加成功",MessageAlert.Status.SUCCESS),BrochureAdmin.view.add.hide()):new MessageAlert("添加失败",MessageAlert.Status.EXCEPTION),table_init()},edit:function(){var e=window._target,t=formToSet("#edit_Brochure");for(var r in t)e[r]=t[r];apiConfig.brochure.Edit(e._id,t)>0?(new MessageAlert("修改成功",MessageAlert.Status.SUCCESS),BrochureAdmin.view.edit.hide(),ClearInputs("#edit_Brochure"),ClearSelection("#edit_Brochure"),ClearTextArea("#edit_Brochure")):new MessageAlert("修改失败",MessageAlert.Status.EXCEPTION),table_init()},destory:function(){ClearAllFields("#Add")},init:function(){bindInputQuery({input:"#supplierfk",datasourceAPI:apiConfig.supplier.Search,searchObj:{},innerTextName:"_suppliername",valueName:"_id",callback:function(e){}})}}},DealerAdmin={view:{add:{show:function(){$("#Add").modal()},hide:function(){$("#Add").modal("hide")}},edit:{show:function(e){window._target=apiConfig.dealer.Get(e),autoComplateInfo(window._target,"#edit_Dealer"),$("#Edit").modal()},hide:function(){$("#Edit").modal("hide")}},delete:{show:function(e){window._target=apiConfig.dealer.Get(e),$("#Delete").modal()},hide:function(){$("#Delete").modal("hide")}}},event:{add:function(){var e=formToSet("#add_Dealer");apiConfig.dealer.Add(e)>0?(new MessageAlert("添加成功",MessageAlert.Status.SUCCESS),DealerAdmin.view.add.hide(),ClearInputs("#add_Dealer"),ClearSelection("#add_Dealer"),ClearTextArea("#add_Dealer")):new MessageAlert("添加失败",MessageAlert.Status.EXCEPTION),table_init()},edit:function(){var e=window._target,t=formToSet("#edit_Dealer");for(var r in t)e[r]=t[r];apiConfig.dealer.Edit(e._id,t)>0?(DealerAdmin.view.edit.hide(),new MessageAlert("修改成功",MessageAlert.Status.SUCCESS),ClearInputs("#edit_Dealer"),ClearSelection("#edit_Dealer"),ClearTextArea("#edit_Dealer")):new MessageAlert("修改失败",MessageAlert.Status.EXCEPTION),table_init()}}},BrochureHistory={show:function(e){BrochureHistory.init(e),$("#History").modal()},hide:function(){$("#History").modal("hide")},init:function(e){generateTableWithPageHelper({target:".infomationTable",templateOpts:tableStructures.Admin.Bruchure.History,counter:apiConfig.brochurehistory.CountById(e),datasourceAPI:apiConfig.brochurehistory.Paging,options:{brochureid:e}})}},PRDetail={show:function(e){e&&(PRDetail.init(e),PRDetail.autoComplate(e)),$("#Detail").on("hidden.bs.modal",function(){PRDetail.destory()}),$("#Detail").modal()},hide:function(){PRDetail.destory(),$("#Detail").modal("hide")},init:function(e){var t=$("#PRD_operation");if($("#progressbar").empty(),t.empty(),window.target||(window.target={}),window.target.PR||(window.target.PR={}),e&&(window.target.PR=apiConfig.purchaserequisition.Get(e)),Enum.role.EMPLOYEE==getCookie("role")||Enum.role.SYSADMIN==getCookie("role"))if(Enum.prstatus.Progress==window.target.PR._prstatus)if(getCookie("account").toLocaleLowerCase()==apiConfig.prprocess.getCurrentStep(e)._taskowner||Enum.role.SYSADMIN==getCookie("role")){$("#Detail textarea#PRD_approvalComments").attr("disabled",!1);t.append('<button type="submit" class="btn btn-primary col-md-5" onclick="PRDetail.view.approve()">审核通过</button>').append('<button type="submit" class="btn btn-danger col-md-5" onclick="PRDetail.view.reject()">拒绝通过</button>')}else{$(".modal-infopart.Approval").hide(),$("#Detail textarea#PRD_approvalComments").attr("disabled",!0);r='<button type="button" class="btn btn-primary col-xs-12 col-md-3" data-dismiss="modal" aria-hidden="true">关闭</button>';t.append(r)}else{$(".modal-infopart.Approval").hide(),$("#Detail textarea#PRD_approvalComments").attr("disabled",!0);r='<button type="button" class="btn btn-primary col-xs-12 col-md-3" data-dismiss="modal" aria-hidden="true">关闭</button>';t.append(r)}else{$(".modal-infopart.Approval").hide(),$("#Detail textarea#PRD_approvalComments").attr("disabled",!0);var r='<button type="button" class="btn btn-primary col-xs-12 col-md-3" data-dismiss="modal" aria-hidden="true">关闭</button>';t.append(r)}},destory:function(){$("#progressbar").empty(),ClearAllFields("#Detail"),window.target&&(window.target.PR&&(window.target.PR=null),window.target=null)},autoComplate:function(e){var t=tableStructures.Dealer.MyOrder.orderDetail;if(e){var r=apiConfig.purchaserequisition.Get(e);r._demanderfk=r._requestoremployeefk||r._requestordealerfk,r._logistics=r._logistics||"暂无物流信息",r._deliverydate=r._deliverydate||"无",r._deliveryaddress=r._deliveryaddress||"无",r._consignee=r._consignee||"无";var a=null;if(r._requestoremployeefk){var o=a=apiConfig.employee.Get(r._requestoremployeefk)[0];r._phonenumber=o.mobileField||"无",r._email=o.emailField||"无",r._region=o.regionField||"无"}else if(r._requestordealerfk){var i=a=apiConfig.dealer.Get(r._requestordealerfk);r._phonenumber=i._phonenumber||"无",r._email=i._email||"无",r._region=i._dealerregion||"无"}r._submitterdealerfk?r._submitterdealerfk!=r._requestordealerfk?r._submitter=apiConfig.dealer.Get(r._submitterdealerfk):r._submitter=a._dealername:r._submitteremployeefk&&(r._submitteremployeefk!=r._requestoremployeefk?r._submitter=apiConfig.employee.Get(r._submitteremployeefk)[0]:r._submitter=a.nameField),autoComplateInfo(r,"#Detail","PRD");var n=apiConfig.purchaseitem.Paging(e,0,100);(new table).loadFromTemplateJson(n,t).to("#InfomationArea")}for(var s=apiConfig.prprocess.Search({keyword:e}),u=0;u<s.length;u++){var l=s[u]._result,d=s[u]._lastmodified,l=s[u]._result,p=s[u]._taskowner,c=s[u]._comments,h=s[u]._prprocessstep,m='<li class="glyphicon"><a title="'+c+'">'+h+'</a><span class="small">'+p+'<span><span class="operationtime">'+d+"</span></li>",f=$(m);f.css("width",100/s.length+"%"),l==Enum.enumApprovalResult.NoAction?f.addClass("noAction"):l==Enum.enumApprovalResult.Ready?f.addClass("processing"):l==Enum.enumApprovalResult.Success||l==Enum.enumApprovalResult.Approved?f.addClass("approved"):l!=Enum.enumApprovalResult.Rejected&&l!=Enum.enumApprovalResult.Failure||f.addClass("rejected"),h==Enum.processStatus.NotifiedParty&&f.addClass("infomation"),$("#progressbar").append(f)}},view:{approve:function(){$("#Approve").modal()},reject:function(){$("#Reject").modal()}},event:{approve:function(){if(window.target.PR){var e=window.target.PR._id,t=$("textarea#PRD_approvalComments").val();apiConfig.prprocess.Approve(e,t)?(new MessageAlert("审核通过！",MessageAlert.Status.SUCCESS),PRDetail.hide()):new MessageAlert("审核失败",MessageAlert.Status.EXCEPTION)}table_init()},reject:function(){if(window.target.PR){var e=window.target.PR._id,t=$("textarea#PRD_approvalComments").val();1==apiConfig.prprocess.Reject(e,t)?(new MessageAlert("审核通过！",MessageAlert.Status.SUCCESS),PRDetail.hide()):new MessageAlert("审核失败",MessageAlert.Status.EXCEPTION),table_init()}}}};$("#Detail").on("hidden.bs.modal",function(){PRDetail.destory()});var PurchaseItem={show:function(){PurchaseItem.init(),$("#PruchaseItem").modal()},hide:function(){PurchaseItem.destory(),$("#PruchaseItem").modal("hide")},autoComplate:function(e){var t="object"==(void 0===e?"undefined":_typeof(e))?e:apiConfig.purchaseitem.Get(e);bindOptionData({$select:"#_brochurename",datasource:apiConfig.brochure.Search({keyword:t._brochurename}),innerTextName:"_brochurename",valueName:"_brochurename"}),t.brochure=t._brochurename,autoComplateInfo(t,"#PruchaseItem_form")},init:function(){$("#PruchaseItem").unbind("hidden.bs.modal"),$("#PruchaseItem").on("hidden.bs.modal",function(e){PurchaseItem.destory()}),bindInputQuery({input:"#brochure",datasourceAPI:apiConfig.brochure.Search,searchObj:{},innerTextName:"_brochurename",valueName:"_brochurename",callback:function(e){console.log(e)}})},update:function(){for(var e=window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID],t=window._target.PR._id,r=0;r<e.length;r++)e[r]._purchaserequisitionfk=t;return console.log(e),apiConfig.purchaseitem.Add(e)},updatePITable:function(){if(window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID]){var e=window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID],t=tableStructures.Dealer.MyOrder.PurchaseRequisitionItemTable,r=(new table).loadFromTemplateJson(e,t);window.__PurchaseRequisitionItem_table=r,r.to(window._targetPITableArea)}},destory:function(){ClearInputs("#PruchaseItem"),validator.Restore(),$("#PIOperation").empty(),window._target.PI=null,window._operation=null},view:{init:function(){window._target||(window._target={}),window._target.PI||(window._target.PI={});var e=$("#PIOperation"),t='<button type="submit" class="btn btn-primary" onclick="PurchaseItem.hide()"><span class="glyphicon glyphicon-remove"></span></button>';switch(window._operation){case Enum.operation.Update:e.append($(t)).append($('<button type="submit" class="btn btn-primary" onclick="PurchaseItem.event.edit()"><span class="glyphicon glyphicon-ok"></span></button>'));break;case Enum.operation.Create:e.append($('<button type="submit" class="btn btn-primary" onclick="PurchaseItem.event.add()"><span class="glyphicon glyphicon-ok"></span></button>')).append($(t)).append($('<button type="submit" class="btn btn-primary" onclick="PurchaseItem.event.append()"><span class="glyphicon glyphicon-plus"></span></button>'));break;default:e.append($(t))}bindInputQuery("#brochure",apiConfig.brochure.Top(1e3),"_brochurename","_brochurename",function(){})},add:function(){window._operation=Enum.operation.Create,PurchaseItem.view.init(),PurchaseItem.show()},edit:function(e){if(window._operation=Enum.operation.Update,PurchaseItem.view.init(),e.search("[unsave]")>=0){var t=arrayToSet(window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID],"_id");window._target.PI=t[e]}else window._target.PI=apiConfig.purchaseitem.Get(e);PurchaseItem.show(),PurchaseItem.autoComplate(window._target.PI)}},event:{add:function(){PurchaseItem.event.append()&&PurchaseItem.hide()},append:function(){if(!validator.Result("#PruchaseItem_form"))return new MessageAlert("填写错误，请确认数据！",MessageAlert.Status.ERROR),!1;var e=[],t=++row_counter+"[unsave]";e.push(t);var r=formToSet("#PruchaseItem_form");r._id=t;for(var a=["_brochurename","_quantity","_deliverypriorityfk"],o=0;o<a.length;o++)e.push(r[a[o]]);return window.__PurchaseRequisitionItem_table&&(window.__PurchaseRequisitionItem_table.addRow(e),window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID].push(r)),ClearInputs("#PruchaseItem_form",["brochure","_quantity"]),ClearSelection("#PruchaseItem_form"),!0},edit:function(){var e=window._target.PI,t=window._target.PI._id,r=formToSet("#PruchaseItem_form");for(var a in r)e[a]=r[a];e._id=t;t.toString().search("[unsave]");if(t.toString().search("[unsave]")>=0||apiConfig.purchaseitem.Edit(t,e)){var o=arrayToSet(window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID],"_id");for(var i in e)o[t][i]=e[i];new MessageAlert("修改成功",MessageAlert.Status.SUCCESS)}else new MessageAlert("更新失败",MessageAlert.Status.EXCEPTION);PurchaseItem.updatePITable(),ClearInputs("#PruchaseItem_form"),PurchaseItem.hide()},delete:function(e){var t=window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID];if(e.search("[unsave]")>=0||apiConfig.purchaseitem.Delete(e)){var r=deleteFromObjectArray(t,"_id",e);window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID]=r,window.__PurchaseRequisitionItem_table.data[e].remove(),new MessageAlert("删除成功",MessageAlert.Status.SUCCESS)}else new MessageAlert("删除失败",MessageAlert.Status.EXCEPTION)}}};$("#PruchaseItem").on("hidden.bs.modal",function(e){PurchaseItem.destory()});var row_counter=0,PurchaseRequisition={show:function(){PurchaseRequisition.init(),$("#PurchaseRequisition").modal()},hide:function(){PurchaseRequisition.destory(),$("#PurchaseRequisition").modal("hide")},init:function(){switch($("#PurchaseRequisition").unbind("hidden.bs.modal"),$("#PurchaseRequisition").on("hidden.bs.modal",function(){PurchaseRequisition.destory()}),window.__PurchaseRequisitionItem_Unsave_set||(window.__PurchaseRequisitionItem_Unsave_set={}),$("#_deliverydate").datetimepicker({format:"yyyy-mm-dd",weekStart:1,startDate:new Date,autoclose:!0,startView:2,minView:2,forceParse:!1,language:"zh-CN"}),bindInputQuery({input:"#requestordealerfk",datasourceAPI:apiConfig.dealer.Search,searchObj:{},innerTextName:"_dealername",valueName:"_id",callback:function(e){var t=$("#_requestordealerfk").val(),r=apiConfig.dealer.Get(t);$("#_region").val(r._dealerregion)}}),bindInputQuery({input:"#requestoremployeefk",datasourceAPI:apiConfig.employee.Search,searchObj:{},innerTextName:"eNNameField",valueName:"accountField",callback:function(e){$("#_requestoremployeefk").val(e.accountField),$("#_region").val(e.regionField)}}),$("#submitter").val(getCookie("account")),$("#submitter").attr("readonly","readonly"),getCookie("role")){case Enum.role.DEALEAR:var e=JSON.parse(getCookie("user"));e&&($("#_requestordealerfk").val(e._id),$("#_submitterdealerfk").val(e._id),$("#requestordealerfk").val(e._dealername),$("#submitterdealerfk").val(e._dealername),$("#requestordealerfk").attr("readonly","readonly"),$("#requestoremployeefk").attr("readonly","readonly"),$("#_region").val(e._dealerregion),$("#_region").attr("readonly","readonly"));break;case Enum.role.EMPLOYEE:case Enum.role.SYSADMIN:var t=JSON.parse(getCookie("user"));$("#agentCheck input").on("change",function(e){$(".requestorInput").hide();var t=$("#agentCheck input[name='agent']:checked");$(".requestorInput input").val(""),$(".requestorInput input").removeAttr("data-regxRule"),"forEmp"==t.data("value")?($("#forEmployee input").removeAttr("disabled"),$("#forEmployee select").attr("data-regxRule","selectEmployee"),$("#forEmployee").show()):($("#forDealer input").removeAttr("disabled"),$("#forDealer select").attr("data-regxRule","selectDealer"),$("#forDealer").show()),validator.init()}),(t=JSON.parse(getCookie("user")))&&(Enum.role.EMPLOYEE==getCookie("role")?($("#requireAgent").on("change",function(){$(".requestorInput input").attr("disabled","true"),$(this).is(":checked")?($("#_requestoremployeefk").empty(),$("#requestoremployeefk").val(""),$("#requestoremployeefk").removeAttr("readonly"),$("#agentCheck input").removeAttr("disabled"),$("#agentCheck").css("visibility","visible")):(bindOptionData({$select:"#_requestoremployeefk",datasource:apiConfig.employee.Search({keyword:getCookie("name")}),innerTextName:"eNNameField",valueName:"accountField"}),$("#_requestoremployeefk").val(t.accountField),$("#_region").val(t.regionField),$(".queryinput").val(""),$(".requestorInput").hide(),$("#forEmployee").show(),ClearRadio("#agentCheck"),$("#requestoremployeefk").val(t.eNNameField),$("#_requestoremployeefk").val(t.accountField),$("#requestoremployeefk").attr("readonly","readonly"),$("#forEmployee").attr("readonly","readonly"),$("#agentCheck input").attr("checked","false"),$("#agentCheck input").attr("disabled","true"),$("#agentCheck").css("visibility","hidden"))}),bindOptionData({$select:"#_requestoremployeefk",datasource:apiConfig.employee.Search({keyword:getCookie("name")}),innerTextName:"eNNameField",valueName:"accountField"}),$("#requestoremployeefk").val(t.eNNameField),$("#_requestoremployeefk").val(t.accountField),$("#requestoremployeefk").attr("readonly","readonly"),$(".requestorInput").hide(),$("#forEmployee").show(),$("#_region").val(t.regionField),$("#_region").attr("readonly","readonly"),$("#agentCheck").css("visibility","hidden")):($("#requireAgent").remove(),$(".requestorInput").hide(),$("#agentCheck input:first").prop("checked","checked"),$("#forEmployee").show()))}},autoComplate:function(e){window._targetPITableArea="#InfomationAddArea",e&&(autoComplateInfo(apiConfig.purchaserequisition.Get(e),"#PurchaseRequisition_form"),PurchaseRequisition.loadPITable(e))},loadPITable:function(e){var t=apiConfig.purchaseitem.Paging(e,0,100);window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID]=t;var r=tableStructures.Dealer.MyOrder.PurchaseRequisitionItemTable,a=(t.slice(0),(new table).loadFromTemplateJson(t,r));window.__PurchaseRequisitionItem_table=a,a.to(window._targetPITableArea)},detail:function(e){window._operation=Enum.operation.Read,PRDetail.show(e)},destory:function(){ClearAllFields("#PurchaseRequisition"),window.__PurchaseRequisitionItem_table&&(window.__PurchaseRequisitionItem_table.remove(),window.__PurchaseRequisitionItem_table=null),window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID]=null,window.__PurchaseRequisition_tempID=null,window.__PurchaseRequisitionItem_Unsave_set=null,window._target&&(window._target.PR&&(window._target.PR=null),window._target=null),window._operation=null,window._targetPITableArea=null,$("#operation").empty()},view:{init:function(){window._targetPITableArea="#InfomationAddArea",ClearAllFields("#PurchaseRequisition"),$("#progressbar").empty(),$("#operation").empty(),window.__PurchaseRequisition_tempID=generateUUID(),window._target||(window._target={}),window._target.PR||(window._target.PR={}),window.__PurchaseRequisitionItem_Unsave_set||(window.__PurchaseRequisitionItem_Unsave_set={}),window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID]||(window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID]=[]),window.__PurchaseRequisitionItem_table||(window.__PurchaseRequisitionItem_table=(new table).new(tableStructures.Dealer.MyOrder.PurchaseRequisitionItemTable,["编号","申请种类","交付时间","申请数量","收货人","收货电话","收货地址"]),window.__PurchaseRequisitionItem_table.to(window._targetPITableArea));var e=$("#operation"),t='<button type="button" class="btn btn-success col-xs-3 col-md-3 col-xs-offset-1" onclick="PurchaseRequisition.event.draft()">草稿</button>',r='<button type="button" class="btn btn-primary col-xs-3 col-md-3" onclick="PurchaseRequisition.event.submit()">提交</button>',a='<button type="button" class="btn btn-danger col-xs-3 col-md-3" data-dismiss="modal" aria-hidden="true">取消</button>';switch(window._operation){case Enum.operation.Update:e.append($('<button type="button" class="btn btn-primary col-xs-3 col-md-3" onclick="PurchaseRequisition.event.edit()">修改</button>')).append($(r)).append($(a));break;case Enum.operation.Create:case Enum.operation.Copy:e.append($(t)).append($(r)).append($(a));break;default:e.append($('<button type="button" class="btn btn-primary col-xs-3 col-md-3" data-dismiss="modal" aria-hidden="true">关闭</button>'))}},create:function(){window._operation=Enum.operation.Create,PurchaseRequisition.view.init(),PurchaseRequisition.show(),PurchaseRequisition.autoComplate()},copy:function(e){window._operation=Enum.operation.Copy,PurchaseRequisition.view.init(),window._target.PR=apiConfig.purchaserequisition.Get(e),PurchaseRequisition.show(),PurchaseRequisition.autoComplate(e)},edit:function(e){window._operation=Enum.operation.Update,PurchaseRequisition.view.init(),window._target.PR=apiConfig.purchaserequisition.Get(e),PurchaseRequisition.show(),PurchaseRequisition.autoComplate(e)},delete:function(e){window._operation=Enum.operation.Delete,PurchaseRequisition.view.init(),window._target.PR=apiConfig.purchaserequisition.Get(e),$("#Delete").modal()}},event:{draft:function(){var e=window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID];e=e||[];$("#submitter").val();var t=formToSet("#PurchaseRequisition_form");switch(t._prcreated=new Date,t._prstatus=Enum.prstatus.Draft,getCookie("role")){case Enum.role.EMPLOYEE:t._submitteremployeefk=getCookie("account"),t._requestordealerfk=null;break;case Enum.role.DEALEAR:t._submitterdealerfk=getCookie("uid"),t._requestordealerfk=getCookie("uid")}var r=apiConfig.purchaserequisition.Draft(t);if(r>0){for(var a=0;a<e.length;a++)e[a]._purchaserequisitionfk=r;apiConfig.purchaseitem.Add(e);new MessageAlert("该条记录已加入草稿箱！",MessageAlert.Status.SUCCESS)}else new MessageAlert("未知错误，请检查数据！",MessageAlert.Status.SUCCESS);table_init(),PurchaseRequisition.hide()},submit:function(){var e=window.__PurchaseRequisitionItem_Unsave_set[window.__PurchaseRequisition_tempID];if((e=e||[]).length<=0)new MessageAlert("请购单item数量不能为0",MessageAlert.Status.ERROR);else{if(validator.Result("#PurchaseRequisition_form")){var t=$("#submitter").val(),r=formToSet("#PurchaseRequisition_form");switch(r._prcreated=new Date,r._prstatus=Enum.prstatus.Progress,window._operation==Enum.operation.Update&&(r._id=window._target.PR._id,r._prstatus=window._target.PR._prstatus),getCookie("role")){case Enum.role.EMPLOYEE:r._submitteremployeefk=t,r._requestordealerfk=null;break;case Enum.role.DEALEAR:r._submitterdealerfk=getCookie("uid"),r._requestordealerfk=getCookie("uid")}var a=apiConfig.purchaserequisition.Add(r);if(a>0){for(var o=0;o<e.length;o++)e[o]._purchaserequisitionfk=a;apiConfig.purchaseitem.Add(e)>0?(apiConfig.prprocess.GenerateAll(a),new MessageAlert("提交成功！",MessageAlert.Status.SUCCESS),PurchaseRequisition.hide(),validator.Restore()):new MessageAlert("采购物品信息有误！",MessageAlert.Status.EXCEPTION)}else new MessageAlert("提交失败!请检查表单数据！",MessageAlert.Status.EXCEPTION)}else new MessageAlert("提交失败!请检查表单数据！",MessageAlert.Status.EXCEPTION);table_init()}},edit:function(){$("#saver").val(getCookie("name"));var e=formToSet("#PurchaseRequisition_form");for(var t in e)window._target.PR[t]=e[t];if(apiConfig.purchaserequisition.Edit(window._target.PR._id,window._target.PR)){PurchaseItem.update();new MessageAlert("修改成功！",MessageAlert.Status.SUCCESS)}else new MessageAlert("修改失败！",MessageAlert.Status.EXCEPTION);PurchaseRequisition.hide(),table_init()},delete:function(){if(window._target.PR){var e=window._target.PR._id;apiConfig.purchaserequisition.Delete(e)?(new MessageAlert("成功删除该草稿！",MessageAlert.SUCCESS),$("#Delete").modal("hide")):new MessageAlert("删除草稿失败！请重试！",MessageAlert.EXCEPTION),table_init()}}}},SupplierPRDetail={show:function(){SupplierPRDetail.view.init(),$("#SupplierPRDetail").modal()},hide:function(){SupplierPRDetail.destory(),$("#SupplierPRDetail").modal("hide")},autoComplate:function(e){var t=tableStructures.Supplier.MyOrder.ExpressUpdateDetail;if(e){var r=apiConfig.purchaseitem.Paging(e,0,100);(new table).loadFromTemplateJson(r,t).to("#SupplierPRDetail .goodsInfomation")}var a=window._target.PR._logistics;$("#_logistics").val(a);for(var o=a.split(","),i=0;i<o.length;i++)SupplierPRDetail.event.Express.appendExpress(o[i])},destory:function(){window._target.PI=null,window._target.PR=null,window._target=null,$(".expressRow").remove()},view:{init:function(){$(".expressRow").remove(),window._target||(window._target={}),window._target.PR||(window._target.PR={}),window._target.PI||(window._target.PI={})},update:function(e){window._operation=Enum.operation.Read,SupplierPRDetail.view.init(),window._target.PR=apiConfig.purchaserequisition.Get(e),SupplierPRDetail.show(),SupplierPRDetail.autoComplate(e)},finish:function(){window._operation=Enum.operation.Update,SupplierPRDetail.destory(),SupplierPRDetail.hide()},Express:{}},event:{Express:{appendExpress:function(e){var t='\n            <div class="col-sm-11 col-xs-11 col-md-11 col-lg-11 mt10 mb10 expressRow">\n              <label for="expressid" class="col-xs-2 col-md-2 control-label">物流单号</label>\n              <div class="input-group">\n                <input name="expressid" placeholder="请输入物流单号" type="text" class="form-control" onkeyup="SupplierPRDetail.event.Express.change()" value="'+(e=e||"")+'">\n                <span class="input-group-btn">\n                    <button class="btn btn-default" type="button" onclick="SupplierPRDetail.event.Express.reduceExpress(this)">-</button>\n                </span>\n              </div>\x3c!-- /input-group --\x3e\n            </div>\x3c!-- /.col-lg-6 --\x3e\n          ';$("#Express_form").find("#ExpressAppendBtn").before($(t))},reduceExpress:function(e){(e=$(e)).parents(".expressRow").remove(),SupplierPRDetail.event.Express.change()},change:function(){$("#Express_form").find("#_logistics").val("");for(var e="",t=$("#Express_form").serializeArray(),r=0;r<t.length;r++)"expressid"==t[r].name&&(e+=t[r].value+",");for(;-1!=e.lastIndexOf(",")&&e.lastIndexOf(",")==e.length-1;)e=e.slice(0,e.length-1);$("#Express_form").find("#_logistics").val(e)},save:function(){window._target.PR._logistics=$("#Express_form").find("#_logistics").val(),apiConfig.purchaserequisition.Edit(window._target.PR._id,window._target.PR)?(new MessageAlert("保存成功",MessageAlert.Status.SUCCESS),SupplierPRDetail.hide(),console.log("Saved!")):new MessageAlert("保存失败",MessageAlert.Status.ERROR)}},finish:function(){var e=window._target.PR._id;1==apiConfig.purchaserequisition.SupplierComplete(e)?new MessageAlert("您已完成该订单",MessageAlert.Status.SUCCESS):new MessageAlert("订单完成失败",MessageAlert.Status.EXCEPTION),SupplierPRDetail.hide(),table_init()}}},root="",apiConfig={brochure:{Get:function(e){return GET(root+"/api/brochure/"+e)},Add:function(e,t){return POST(root+"/api/brochure/new?actionOwner="+e,t)},Edit:function(e,t){var r=getCookie("account");return PUT(root+"/api/brochure/"+e+"/update?actionOwner="+r,t)},Delete:function(e,t){return PUT(root+"/api/brochure/"+e+"/softdelete",t)},Count:function(){return GET(root+"/api/brochure/count")},Search:function(e){var t=e.keyword;return GET(root+"/api/brochure/search("+t+")")},Top:function(e){return GET(root+"/api/brochure/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex,a=e.keyword;if(a)o=root+"/api/brochure/search("+a+","+t+","+r+")";else var o=root+"/api/brochure/paging("+t+","+r+")";return GET(o)}},brochurehistory:{Get:function(e){return GET(root+"/api/brochurehistory/"+e)},Add:function(e){return POST(root+"/api/brochurehistory/new",e)},Count:function(){return GET(root+"/api/brochurehistory/count")},CountById:function(e){return GET(root+"/api/brochurehistory/count("+e+")")},Top:function(e){return GET(root+"/api/brochurehistory/top("+e+")")},Edit:function(e,t){return PUT(root+"/api/brochurehistory/"+e+"/update",t)},Paging:function(e){var t=e.brochureid,r=e.startIndex,a=e.endIndex;return GET(root+"/api/brochurehistory/paging("+t+","+r+","+a+")")}},dealer:{Get:function(e){return GET(root+"/api/dealer/"+e)},GetByUserName:function(e){for(var t=this.Search({username:e}),r=0;r<t.length;r++){var a=t[r];if(a._dealername==e)return a}return null},Add:function(e){return POST(root+"/api/dealer/new",e)},Edit:function(e,t){return PUT(root+"/api/dealer/"+e+"/update",t)},Delete:function(e,t){return PUT(root+"/api/dealer/"+e+"/softdelete",t)},Count:function(){return GET(root+"/api/dealer/count")},Search:function(e){var t=e.keyword;return GET(root+"/api/dealer/search?keyWord="+t)},Top:function(e){return GET(root+"/api/dealer/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex;return GET(root+"/api/dealer/paging("+t+","+r+")")},Login:function(e,t){return PUT(root+"/api/dealer/login?username="+e+"&password="+t)}},optionlist:{Get:function(e){return GET(root+"/api/optionlist/"+e)},Add:function(e){return POST(root+"/api/optionlist/new",e)},Edit:function(e,t){return PUT(root+"/api/optionlist/"+e+"/update",t)},Delete:function(e,t){return DELETE(root+"/api/optionlist/"+e)},Count:function(){return GET(root+"/api/optionlist/count")},Top:function(e){return GET(root+"/api/optionlist/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex;return GET(root+"/api/optionlist/paging("+t+","+r+")")},GetByCategory:function(e){return GET(root+"/api/optionlist/category("+e+")")}},prprocess:{Get:function(e){return GET(root+"/api/prprocess/"+e)},Add:function(e){return POST(root+"/api/prprocess/new",e)},Edit:function(e,t){return PUT(root+"/api/prprocess/"+e+"/update",t)},Delete:function(e,t){return DELETE(root+"/api/prprocess/"+e)},GenerateAll:function(e){return POST(root+"/api/prprocess/generateall?prID="+e)},Count:function(){return GET(root+"/api/prprocess/count")},Top:function(e){return GET(root+"/api/prprocess/top("+e+")")},Paging:function(e,t,r){return GET(root+"/api/prprocess/paging("+e+","+t+","+r+")")},Search:function(e){var t=e.keyword;return GET(root+"/api/prprocess/search("+t+")")},Approve:function(e,t){var r=apiConfig.prprocess.getCurrentStep(e),a=r._taskowner,o=null;if(r&&(getCookie("role")==Enum.role.EMPLOYEE&&getCookie("account")==a.toUpperCase()||getCookie("role")==Enum.role.SYSADMIN)){var i=r._id;o=PUT(root+"/api/prprocess/"+i+"/Approve?comments="+t)}return o},Reject:function(e,t){var r=apiConfig.prprocess.getCurrentStep(e),a=r._taskowner,o=null;if(r){if((getCookie("role")!=Enum.role.EMPLOYEE||getCookie("account")!=a.toUpperCase())&&getCookie("role")!=Enum.role.SYSADMIN)throw"Permission Denied";var i=r._id;o=PUT(root+"/api/prprocess/"+i+"/Reject?comments="+t)}return o},getCurrentStep:function(e){for(var t=apiConfig.prprocess.Paging(e,0,1e3),r=0;r<t.length;r++){var a=t[r];if(Enum.enumApprovalResult.Ready==a._result)return a}return console.log("当前PR已完成！"),{_taskowner:""}},getStepByAccount:function(e,t){for(var r=apiConfig.prprocess.Paging(e,0,1e3),a=[],o=0;o<r.length;o++){var i=r[o];t==i._taskowner&&a.push(i)}return a},getPrStepCommentsByAccount:function(e,t){var r=this.getStepByAccount(e,t),a=[];if(r.length>0)for(var o=0;o<r.length;o++){var i={date:r[o]._lastmodified,comment:r[o]._comments};a.push(i)}return a}},prprocesssetting:{Get:function(e){return GET(root+"/api/prprocesssetting/"+e)},Add:function(e){return POST(root+"/api/prprocesssetting/new",e)},Edit:function(e,t){return PUT(root+"/api/prprocesssetting/"+e+"/update",t)},Delete:function(e,t){return DELETE(root+"/api/prprocesssetting/"+e)},Top:function(e){return GET(root+"/api/prprocesssetting/top("+e+")")},Paging:function(e){var t=e.purchaseRequisitionid,r=e.startIndex,a=e.endIndex;return GET(root+"/api/prprocesssetting/paging("+t+","+r+","+a+")")}},purchaseitem:{Get:function(e){return GET(root+"/api/purchaseitem/"+e)},Add:function(e){return POST(root+"/api/purchaseitem/new",e)},Edit:function(e,t){return PUT(root+"/api/purchaseitem/"+e+"/update",t)},UpdateLogitics:function(e,t){return PUT(root+"/api/purchaseitem/"+e+"/updatelogistics",t)},Delete:function(e){return DELETE(root+"/api/purchaseitem/"+e)},Top:function(e){return GET(root+"/api/purchaseitem/top("+e+")")},Paging:function(e,t,r){return GET(root+"/api/purchaseitem/paging("+e+","+t+","+r+")")}},purchaserequisition:{Get:function(e){return GET(root+"/api/purchaserequisition/"+e)},Add:function(e){return POST(root+"/api/purchaserequisition/submit",e)},Edit:function(e,t){return PUT(root+"/api/purchaserequisition/"+e+"/update",t)},Delete:function(e){return DELETE(root+"/api/purchaserequisition/"+e)},Count:function(){return GET(root+"/api/purchaserequisition/count")},CountByDealer:function(e,t){return GET(root+"/api/purchaserequisition/countbydealer("+e+","+t+")")},CountByEmployee:function(e,t){return GET(root+"/api/purchaserequisition/countbyemployee("+e+","+t+")")},Search:function(e){var t=e.keyword;return GET(root+"/api/purchaserequisition/search?keyWord="+t)},SearchByStatus:function(e){var t=e.role,r=e.uid,a=e.status,o=e.startIndex,i=e.endIndex;return GET(root+"/api/purchaserequisition/search("+t+","+r+","+a+","+o+","+i+")")},SearchByKeywordAndStatus:function(e){var t=e.role,r=e.uid,a=e.status,o=e.keyword,i=e.startIndex,n=e.endIndex;return GET(root+"/api/purchaserequisition/search("+t+","+r+","+a+","+o+","+i+","+n+")")},Top:function(e){return GET(root+"/api/purchaserequisition/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex;return GET(root+"/api/purchaserequisition/paging("+(t=t)+","+(r=r)+")")},Approve:function(e){this.Get(e)},Reject:function(e){},Draft:function(e){return POST(root+"/api/purchaserequisition/draft",e)},Submit:function(e){return POST(root+"/api/purchaserequisition/submit",e)},SupplierComplete:function(e){var t=apiConfig.prprocess.getCurrentStep(e);if(!t||Enum.processStatus.SupplierUpdate!=t._prprocessstep)return!1;var r=!1;return t&&(getCookie("role")!=Enum.role.SUPPLIER&&getCookie("role")!==Enum.role.SYSADMIN||(r=PUT(root+"/api/purchaserequisition/"+e+"/SupplierComplete"))),r}},PRSupplierView:{Count:function(e){return GET(root+"/api/PRSupplierView/count?completed="+e)},Search:function(e){var t=e.isCompeleted,r=e.keyword,a=e.startIndex,o=e.endIndex;return GET(root+"/api/PRSupplierView/search("+t+","+r+","+a+","+o+")")},Paging:function(e){var t=e.isCompeleted,r=e.startIndex,a=e.endIndex;return GET(root+"/api/PRSupplierView/search("+t+","+r+","+a+")")}},supplier:{Get:function(e){return GET(root+"/api/supplier/"+e)},Add:function(e){return POST(root+"/api/supplier/new",e)},Edit:function(e,t){return PUT(root+"/api/supplier/"+e+"/update",t)},Delete:function(e,t){return PUT(root+"/api/supplier/"+e+"/softdelete",t)},Count:function(){return GET(root+"/api/supplier/count")},Search:function(e){var t=e.keyword;return GET(root+"/api/supplier/search?keyWord="+t)},Top:function(e){return GET(root+"/api/supplier/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex;return GET(root+"/api/supplier/paging("+t+","+r+")")},Login:function(e,t){return PUT(root+"/api/supplier/login?username="+e+"&password="+t)}},systemsetting:{Get:function(e){return GET(root+"/api/systemsetting/"+e)},Add:function(e){return POST(root+"/api/systemsetting/new",e)},Edit:function(e,t){return PUT(root+"/api/systemsetting/"+e+"/update",t)},Delete:function(e,t){var r=root+"/api/systemsetting/"+e;return DETELE(r)},Count:function(){return GET(root+"/api/systemsetting/count")},Search:function(e){var t=e.keyword;return GET(root+"/api/systemsetting/search?keyWord="+t)},Top:function(e){return GET(root+"/api/systemsetting/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex;return GET(root+"/api/systemsetting/paging("+t+","+r+")")}},systemuser:{Get:function(e){return GET(root+"/api/systemuser/"+e)},Add:function(e){return POST(root+"/api/systemuser/new",e)},Edit:function(e,t){return PUT(root+"/api/systemuser/"+e+"/update",t)},Delete:function(e,t){return PUT(root+"/api/systemuser/"+e+"/softdelete",t)},Count:function(){return GET(root+"/api/systemuser/count")},Search:function(e){var t=e.keyword;return GET(root+"/api/systemuser/search?keyWord="+t)},Top:function(e){return GET(root+"/api/systemuser/top("+e+")")},Paging:function(e){var t=e.startIndex,r=e.endIndex;return GET(root+"/api/systemuser/paging("+t+","+r+")")},Login:function(e,t){return PUT(root+"/api/systemuser/login?username="+e+"&password="+t)}},employee:{Get:function(e){return GET(root+"/api/employee/GetEmployee("+e+")")},Login:function(e,t){return GET(root+"/api/employee/login("+e+","+t+")")},Search:function(e){var t=e.keyword;return GET(root+"/api/employee/search("+t+")")}},PRApproverView:{Count:function(e,t){return GET(root+"/api/PRApproverView/count?account="+e+"&status="+t)},Paging:function(e){var t=e.account,r=e.completed,a=e.startIndex,o=e.endIndex;return GET(root+"/api/PRApproverView/paging("+t+","+r+","+a+","+o)}},PRAdminView:{Count:function(e){return GET(root+"/api/PRAdminView/count?status="+e)},Paging:function(e){var t=e.status,r=e.startIndex,a=e.endIndex;return GET(root+"/api/PRAdminView/paging("+t+","+r+","+a)}}},Enum={role:{EMPLOYEE:"0",DEALEAR:"1",SUPPLIER:"2",SYSADMIN:"3"},prstatus:{Draft:"Draft",Progress:"Progress",Approved:"Approved",Rejected:"Rejected",Failure:"Failure",Delivered:"Delivered",Completed:"Completed"},processStatus:{Submitted:"Submitted",LineManagerApproval:"LineManagerApproval",BUManagerApproval:"BUManagerApproval",MarketingManagerApproval:"MarketingManagerApproval",MarketingDirectorApproval:"MarketingDirectorApproval",NotifiedParty:"NotifiedParty",SupplierUpdate:"SupplierUpdate",End:"End"},enumApprovalResult:{NoAction:"NoAction",Ready:"Ready",Success:"Success",Approved:"Approved",Failure:"Failure",Rejected:"Rejected"},operation:{Create:"Create",Update:"Update",Read:"Read",Delete:"Delete",Copy:"Copy"}},e=function(e){return document.querySelector(e)},log=function(e){return console.log.bind(console)(e)};$("#role").on("change",function(e){window.role=$("#role").val()}),window.role=$("#role").val(),$("#login_form").on("keydown",function(e){13===e.which&&(console.log("Enter"),e.preventDefault(),login())});var tableStructures={Admin:{Bruchure:{History:{tablename:"History",hasHeader:!0,hasButton:!1,keyArr:["id","key","key","prop","prop","prop"],viewOrder:["_id","_direction","_quantity","_operator","_created"],data:[["序列","操作","物品数量","操作人","操作时间"]]},Inventory:{tablename:"Inventory",hasHeader:!0,hasButton:!0,buttonPool:["supplyBtn","historyBtn","editBtn","deleteBtn"],keyArr:["id","key","key","prop","prop"],viewOrder:["_id","_brochurecode","_brochurename","_quantity","_description"],data:[["序列","版本号","物品名称","物品数量","描述"]]}},OrderAdmin:{Order:{tablename:"order",hasHeader:!0,hasDetail:!0,hasButton:!1,viewOrder:["ID","PRNumber","Purpose","Submitter","PRCreated","Approver"],keyArr:["id","prop","key","prop","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间","当前审批人"]]},Reject:{tablename:"reject",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["ID","PRNumber","Purpose","Submitter","PRCreated","PRCompleted"],keyArr:["id","prop","key","prop","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间","结束时间"]]},Success:{tablename:"success",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["ID","PRNumber","Purpose","Submitter","PRCreated","PRCompleted"],keyArr:["id","prop","key","prop","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间","结束时间"]]}},DealerAdmin:{Dealer:{tablename:"dealer",hasHeader:!0,hasButton:!0,buttonPool:["editBtn","deleteBtn"],viewOrder:["_id","_dealercode","_dealername","_dealerregion","_dealerproduct","_phonenumber","_email","_accountname","_password"],keyArr:["id","key","key","prop","prop","prop","prop","key","prop"],data:[["序列","代理商编码","代理商名称","区域","代理产品","手机号","邮箱","账号","密码"]]}},SupplierAdmin:{Supplier:{tablename:"supplier",hasHeader:!0,hasButton:!0,buttonPool:["editBtn","deleteBtn"],keyArr:["id","key","key","prop","prop","prop"],viewOrder:["_id","_suppliercode","_suppliername","_phonenumber","_accountname","_password"],data:[["序列","供应商编码","名称","手机号","账号","密码"]]}},SystemAdmin:{SystemUser:{tablename:"SystemUser",hasHeader:!0,hasButton:!0,buttonPool:["editBtn","deleteBtn"],viewOrder:["_id","_accountname","_password","_email"],keyArr:["id","key","prop","prop"],data:[["序列","账号","密码","邮箱"]]}},Dictionary:{tablename:"Dictionary",hasHeader:!0,hasButton:!0,buttonPool:["editBtn","deleteBtn"],viewOrder:["_id","_optionname","_optionvalue","_sequence","_description","_category"],keyArr:["id","key","prop","prop","prop","prop"],data:[["ID","选项名","选项值","排序值","描述","分类"]]}},Dealer:{MyOrder:{Draft:{tablename:"draft",hasHeader:!0,hasDetail:!1,hasButton:!0,buttonPool:["copyBtn","editBtn","deleteDraftBtn"],viewOrder:["_id","_prnumber","_purposefk","_prcreated"],keyArr:["id","prop","key","prop"],data:[["序列","草稿号","用途","保存时间"]]},PurchaseRequisitionItemTable:{tablename:"PurchaseRequisitionItemTable",hasHeader:!0,hasButton:!0,hasDetail:!1,buttonPool:["PIEditBtn","PIdeleteBtn"],viewOrder:["_id","_brochurename","_quantity","_deliverypriorityfk"],keyArr:["id","key","key","prop"],data:[["编号","申请种类","申请数量","紧急程度"]]},Approving:{tablename:"approving",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purposefk","_prcreated"],keyArr:["id","prop","key","prop"],data:[["序列","订单号","用途","提交时间"]]},Rejected:{tablename:"rejected",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purposefk","_requestorfk","_prcreated","_prcompleted"],keyArr:["id","prop","key","prop","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间","结束时间"]]},Success:{tablename:"success",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purposefk","_requestorfk","_prcreated","_prcompleted"],keyArr:["id","prop","key","prop","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间","结束时间"]]},orderDetail:{name:"orderDetail",hasHeader:!0,hasButton:!1,viewOrder:["_id","_brochurename","_quantity","_deliverypriorityfk"],keyArr:["id","key","key","prop"],data:[["序列","申请种类","申请数量","紧急程度"]]}}},Supplier:{MyOrder:{Approving:{tablename:"approving",hasHeader:!0,hasDetail:!1,hasButton:!0,buttonPool:["expressUpdateBtn"],viewOrder:["_id","_prnumber","_purpose","_requestor","_phonenumber"],keyArr:["id","prop","key","prop","hide"],data:[["序列","订单号","用途","申请人","联系电话"]]},Success:{tablename:"success",hasHeader:!0,hasDetail:!0,hasButton:!1,viewOrder:["_id","_prnumber","_purpose","_requestor","_prCompleted"],keyArr:["id","prop","key","prop","prop"],data:[["序列","订单号","用途","申请人","结束时间"]]},ExpressUpdateDetail:{name:"expressupdatedetail",hasHeader:!0,hasButton:!1,hasDetail:!1,viewOrder:["_id","_brochurename","_quantity","_deliverydate"],keyArr:["id","key","prop","prop"],data:[["序列","物品名字","物品数量","交付时间"]]}},Brochure:{tablename:"Inventory",hasHeader:!0,hasDetail:!1,hasButton:!0,buttonPool:["supplyBtn","historyBtn"],viewOrder:["_id","_brochurecode","_brochurename","_quantity"],keyArr:["id","prop","key","prop"],data:[["序列","物品编号","物品名称","物品数量"]]}},Employee:{MyOrder:{Draft:{tablename:"draft",hasHeader:!0,hasDetail:!1,hasButton:!0,buttonPool:["copyBtn","editBtn","deleteDraftBtn"],viewOrder:["_id","_prnumber","_purposefk","_prcreated"],keyArr:["id","prop","key","prop"],data:[["序列","草稿号","用途","保存时间"]]},PurchaseRequisitionItemTable:{tablename:"PurchaseRequisitionItemTable",hasHeader:!0,hasButton:!0,hasDetail:!1,buttonPool:["PIEditBtn","PIdeleteBtn"],viewOrder:["_id","_brochurename","_quantity","_deliverypriorityfk"],keyArr:["id","key","key","prop"],data:[["编号","申请种类","申请数量","紧急程度"]]},Approving:{tablename:"approving",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purposefk","_prcreated"],keyArr:["id","prop","key","prop"],data:[["序列","订单号","用途","提交时间"]]},Rejected:{tablename:"rejected",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purposefk","_prcreated","_prcompleted"],keyArr:["id","prop","key","prop","prop"],data:[["序列","订单号","用途","提交时间","结束时间"]]},Success:{tablename:"success",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purposefk","_prcreated","_prcompleted"],keyArr:["id","prop","key","prop","prop"],data:[["序列","订单号","用途","提交时间","结束时间"]]},orderDetail:{name:"orderDetail",hasHeader:!0,hasButton:!1,viewOrder:["_id","_brochurename","_quantity","_deliverypriorityfk"],keyArr:["id","key","key","prop"],data:[["序列","申请种类","申请数量","紧急程度"]]}},Approval:{Applying:{tablename:"order",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purpose","_submitter","_prcreated"],keyArr:["id","prop","key","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间"]]},Success:{tablename:"success",hasHeader:!0,hasDetail:!0,hasButton:!0,buttonPool:["copyBtn"],viewOrder:["_id","_prnumber","_purpose","_submitter","_prcreated","_prcompleted"],keyArr:["id","prop","key","prop","prop","prop"],data:[["序列","订单号","用途","提交人","提交时间","结束时间"]]}}}};